"use strict";function earcut(a,b,c){c=c||2;var d=b&&b.length,e=d?b[0]*c:a.length,f=linkedList(a,0,e,c,!0),g=[];if(!f)return g;var h,i,j,k,l,m,n;if(d&&(f=eliminateHoles(a,b,f,c)),a.length>80*c){h=j=a[0],i=k=a[1];for(var o=c;e>o;o+=c)l=a[o],m=a[o+1],h>l&&(h=l),i>m&&(i=m),l>j&&(j=l),m>k&&(k=m);n=Math.max(j-h,k-i)}return earcutLinked(f,g,c,h,i,n),g}function linkedList(a,b,c,d,e){var g,h,i,f=0;for(g=b,h=c-d;c>g;g+=d)f+=(a[h]-a[g])*(a[g+1]+a[h+1]),h=g;if(e===f>0)for(g=b;c>g;g+=d)i=insertNode(g,a[g],a[g+1],i);else for(g=c-d;g>=b;g-=d)i=insertNode(g,a[g],a[g+1],i);return i}function filterPoints(a,b){if(!a)return a;b||(b=a);var d,c=a;do if(d=!1,c.steiner||!equals(c,c.next)&&0!==area(c.prev,c,c.next))c=c.next;else{if(removeNode(c),c=b=c.prev,c===c.next)return null;d=!0}while(d||c!==b);return b}function earcutLinked(a,b,c,d,e,f,g){if(a){!g&&f&&indexCurve(a,d,e,f);for(var i,j,h=a;a.prev!==a.next;)if(i=a.prev,j=a.next,f?isEarHashed(a,d,e,f):isEar(a))b.push(i.i/c),b.push(a.i/c),b.push(j.i/c),removeNode(a),a=j.next,h=j.next;else if(a=j,a===h){g?1===g?(a=cureLocalIntersections(a,b,c),earcutLinked(a,b,c,d,e,f,2)):2===g&&splitEarcut(a,b,c,d,e,f):earcutLinked(filterPoints(a),b,c,d,e,f,1);break}}}function isEar(a){var b=a.prev,c=a,d=a.next;if(area(b,c,d)>=0)return!1;for(var e=a.next.next;e!==a.prev;){if(pointInTriangle(b.x,b.y,c.x,c.y,d.x,d.y,e.x,e.y)&&area(e.prev,e,e.next)>=0)return!1;e=e.next}return!0}function isEarHashed(a,b,c,d){var e=a.prev,f=a,g=a.next;if(area(e,f,g)>=0)return!1;for(var h=e.x<f.x?e.x<g.x?e.x:g.x:f.x<g.x?f.x:g.x,i=e.y<f.y?e.y<g.y?e.y:g.y:f.y<g.y?f.y:g.y,j=e.x>f.x?e.x>g.x?e.x:g.x:f.x>g.x?f.x:g.x,k=e.y>f.y?e.y>g.y?e.y:g.y:f.y>g.y?f.y:g.y,l=zOrder(h,i,b,c,d),m=zOrder(j,k,b,c,d),n=a.nextZ;n&&n.z<=m;){if(n!==a.prev&&n!==a.next&&pointInTriangle(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(n=a.prevZ;n&&n.z>=l;){if(n!==a.prev&&n!==a.next&&pointInTriangle(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.prevZ}return!0}function cureLocalIntersections(a,b,c){var d=a;do{var e=d.prev,f=d.next.next;intersects(e,d,d.next,f)&&locallyInside(e,f)&&locallyInside(f,e)&&(b.push(e.i/c),b.push(d.i/c),b.push(f.i/c),removeNode(d),removeNode(d.next),d=a=f),d=d.next}while(d!==a);return d}function splitEarcut(a,b,c,d,e,f){var g=a;do{for(var h=g.next.next;h!==g.prev;){if(g.i!==h.i&&isValidDiagonal(g,h)){var i=splitPolygon(g,h);return g=filterPoints(g,g.next),i=filterPoints(i,i.next),earcutLinked(g,b,c,d,e,f),void earcutLinked(i,b,c,d,e,f)}h=h.next}g=g.next}while(g!==a)}function eliminateHoles(a,b,c,d){var f,g,h,i,j,e=[];for(f=0,g=b.length;g>f;f++)h=b[f]*d,i=g-1>f?b[f+1]*d:a.length,j=linkedList(a,h,i,d,!1),j===j.next&&(j.steiner=!0),e.push(getLeftmost(j));for(e.sort(compareX),f=0;f<e.length;f++)eliminateHole(e[f],c),c=filterPoints(c,c.next);return c}function compareX(a,b){return a.x-b.x}function eliminateHole(a,b){if(b=findHoleBridge(a,b)){var c=splitPolygon(b,a);filterPoints(c,c.next)}}function findHoleBridge(a,b){var g,c=b,d=a.x,e=a.y,f=-(1/0);do{if(e<=c.y&&e>=c.next.y){var h=c.x+(e-c.y)*(c.next.x-c.x)/(c.next.y-c.y);d>=h&&h>f&&(f=h,g=c.x<c.next.x?c:c.next)}c=c.next}while(c!==b);if(!g)return null;if(a.x===g.x)return g.prev;var k,i=g,j=1/0;for(c=g.next;c!==i;)d>=c.x&&c.x>=g.x&&pointInTriangle(e<g.y?d:f,e,g.x,g.y,e<g.y?f:d,e,c.x,c.y)&&(k=Math.abs(e-c.y)/(d-c.x),(j>k||k===j&&c.x>g.x)&&locallyInside(c,a)&&(g=c,j=k)),c=c.next;return g}function indexCurve(a,b,c,d){var e=a;do null===e.z&&(e.z=zOrder(e.x,e.y,b,c,d)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==a);e.prevZ.nextZ=null,e.prevZ=null,sortLinked(e)}function sortLinked(a){var b,c,d,e,f,g,h,i,j=1;do{for(c=a,a=null,f=null,g=0;c;){for(g++,d=c,h=0,b=0;j>b&&(h++,d=d.nextZ,d);b++);for(i=j;h>0||i>0&&d;)0===h?(e=d,d=d.nextZ,i--):0!==i&&d?c.z<=d.z?(e=c,c=c.nextZ,h--):(e=d,d=d.nextZ,i--):(e=c,c=c.nextZ,h--),f?f.nextZ=e:a=e,e.prevZ=f,f=e;c=d}f.nextZ=null,j*=2}while(g>1);return a}function zOrder(a,b,c,d,e){return a=32767*(a-c)/e,b=32767*(b-d)/e,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),a|b<<1}function getLeftmost(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function pointInTriangle(a,b,c,d,e,f,g,h){return(e-g)*(b-h)-(a-g)*(f-h)>=0&&(a-g)*(d-h)-(c-g)*(b-h)>=0&&(c-g)*(f-h)-(e-g)*(d-h)>=0}function isValidDiagonal(a,b){return equals(a,b)||a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function equals(a,b){return a.x===b.x&&a.y===b.y}function intersects(a,b,c,d){return area(a,b,c)>0!=area(a,b,d)>0&&area(c,d,a)>0!=area(c,d,b)>0}function intersectsPolygon(a,b){var c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&intersects(c,c.next,a,b))return!0;c=c.next}while(c!==a);return!1}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var c=a,d=!1,e=(a.x+b.x)/2,f=(a.y+b.y)/2;do c.y>f!=c.next.y>f&&e<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==a);return d}function splitPolygon(a,b){var c=new Node(a.i,a.x,a.y),d=new Node(b.i,b.x,b.y),e=a.next,f=b.prev;return a.next=b,b.prev=a,c.next=e,e.prev=c,d.next=c,c.prev=d,f.next=d,d.prev=f,d}function insertNode(a,b,c,d){var e=new Node(a,b,c);return d?(e.next=d.next,e.prev=d,d.next.prev=e,d.next=e):(e.prev=e,e.next=e),e}function removeNode(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Node(a,b,c){this.i=a,this.x=b,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}module.exports=earcut;